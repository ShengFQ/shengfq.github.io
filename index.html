<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zn-han">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="blogs and research">
<meta name="keywords" content="技术 博客 随想">
<meta property="og:type" content="website">
<meta property="og:title" content="程序员shengfq">
<meta property="og:url" content="https://www.shengfq.github.io/index.html">
<meta property="og:site_name" content="程序员shengfq">
<meta property="og:description" content="blogs and research">
<meta property="og:locale" content="zn-han">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="程序员shengfq">
<meta name="twitter:description" content="blogs and research">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://www.shengfq.github.io/"/>





  <title>程序员shengfq</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zn-han">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">程序员shengfq</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">技术博客</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.shengfq.github.io/2023/03/13/查控预警规则的链式调度/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="盛富强">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程序员shengfq">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2023/03/13/查控预警规则的链式调度/" itemprop="url">查控预警规则的链式调度</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2023-03-13T00:00:00+08:00">
                2023-03-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>今日心得:</p>
<p>做别人不能做的事情,不敢做的事情,有难度的事情,本身就是一种自信,不管结果怎么样,不要怕,也不要觉得别人不会的我也不会,就是因为别人不会,我才有机会挑战不可能,才能体现我的价值.</p>
<p>需求场景</p>
<p>资金查控是一个应用工具软件,实现从执法办调取案件数据和卡号信息,在本系统内发起申请单,向公安部API发起查控申请,通过异步异地文件交互的方式获取结果.系统是给基层民警办案提供的协查工具,经过上级单位审批提交给公安部统一协调,由银行执行查控结果返回.</p>
<p>执法监督-查控预警模块设计,是民警基于线上系统长时间运行后,对业务运维上提出的新思考,在业务进行时,存在一些不合法的使用场景,于是民警提出了一个excel表格来记录业务违反规则的场景,希望我们系统能提供自动判断违规使用的查控申请,并将案件和账号及违规内容记录到预警内容,提供给省厅民警进行核查.这个规则列表是根据业务进行后会补充的,也会有调整的.甚至会启停.</p>
<table>
<thead>
<tr>
<th>问题清单</th>
<th style="text-align:left">是否可通过现有资金查控平台监督</th>
<th>现有资金查控平台工作要求或无法通过平台监督原因</th>
<th>资金查控平台执法监督功能改造措施</th>
<th>执法监督设计逻辑 （粗体要求系统开发）</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td style="text-align:left">规则1</td>
<td>xxx</td>
<td>xxxxx</td>
<td>ccccc</td>
</tr>
</tbody>
</table>
<p>思考</p>
<p>当时第一次接到这个需求的时候,我没有多想,就是在业务代码中增加拦截规则匹配,基本实现思路就是流水式代码.当我实现了其中几个规则之后,我发现代码越来越难维护,因为每个规则流程都要经历查询待办的案件数据,对案件中的几个关键指标根据规则的业务逻辑进行匹配,如果匹配上就增加案件的预警记录,然后标记该案件在在该规则上的执行任务状态,我要记录很多个执行状态,代码越来越难维护.</p>
<p>经过反复的思考业务场景的特点,  数据源是案件编号—&gt;获取案件编号—&gt;调用规则匹配—-&gt;标记规则完成.其他的规则控制逻辑相同,规则逻辑不同.而且这些规则都需要匹配完成, 这就是一个典型的责任链模式, 责任处理器就是规则处理,这个处理器抽象有两个方法,一个是处理匹配规则,一个是设置下一个处理器.然后我从定时调度任务开启一个任务线程获取待处理的案件列表,经过规则处理器之后,将结果写入到案件列表状态.</p>
<p>设计代码如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">IHandler.java <span class="comment">//链式规则处理接口</span></span><br><span class="line">RequestHandler.java<span class="comment">//链式规则处理抽象类</span></span><br><span class="line">ChainFactoryBuilder.java<span class="comment">//组链,初始化链路bean,执行链式调用	</span></span><br><span class="line">FlwsValidateHandler.java<span class="comment">//业务规则实例</span></span><br><span class="line">Request.java <span class="comment">//请求对象 包含案件对象</span></span><br><span class="line">RequestType.java <span class="comment">//规则枚举</span></span><br><span class="line">IScheduleExecutor.java	<span class="comment">//任务接口 获取数据/执行任务/结束任务	</span></span><br><span class="line">ScheduleExecutorTask.java <span class="comment">//任务接口实现</span></span><br></pre></td></tr></table></figure>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> \* ClassName: ChainFactoryBuilder</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> \* Description:组链,初始化链路bean,执行链式调用</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> \* <span class="doctag">@author</span> shengfq</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> \* <span class="doctag">@date</span>: 2023/3/11 11:08 上午</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChainFactoryBuilder</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> IHandler chain;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line"></span><br><span class="line">  FlwsValidateHandler flwsValidateHandler;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ChainFactoryBuilder</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">​    buildChain();</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   \* TODO 构建责任链处理器链路</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   \* 如果有新的规则添加,则设置</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   \* handler.setNext(next);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   \* 目前只有FlwsValidateHandler</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   \* */</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@PostConstruct</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">buildChain</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">​    IHandler head=flwsValidateHandler;</span><br><span class="line"></span><br><span class="line">​    <span class="comment">//TODO 构建责任链处理器链路,新增的责任处理器要在此处上链</span></span><br><span class="line"></span><br><span class="line">​    <span class="comment">//  head.setNext(iHandler);</span></span><br><span class="line"></span><br><span class="line">​    chain=head;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   \* 压栈处理</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   \* */</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">makeRequest</span><span class="params">(List&lt;Request&gt; requests)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">​    <span class="keyword">if</span>(CollectionUtil.isNotEmpty(requests))&#123;</span><br><span class="line"></span><br><span class="line">​      requests.stream().forEach(item-&gt;&#123;</span><br><span class="line"></span><br><span class="line">​        chain.handleRequest(item);</span><br><span class="line"></span><br><span class="line">​      &#125;);</span><br><span class="line"></span><br><span class="line">​    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   \* 处理请求</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   \* */</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">handleRequest</span><span class="params">(Request req)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   \* 设置下一个处理器</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   \* */</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span>  <span class="title">setNext</span><span class="params">(IHandler next)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> \* 责任链处理器抽象类</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> \* 定义公共执行方法的实现</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> \* <span class="doctag">@author</span> sheng</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> \* <span class="doctag">@date</span> 2023-03-11</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> \* */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">RequestHandler</span> <span class="keyword">implements</span> <span class="title">IHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOGGER = LoggerFactory.getLogger(RequestHandler.class);</span><br><span class="line"> <span class="keyword">private</span> IHandler next;</span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">setNext</span><span class="params">(IHandler next)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.next = next;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  \* Request handler</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"></span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleRequest</span><span class="params">(Request req)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (next != <span class="keyword">null</span> &amp;&amp; !req.isHandled()) &#123;</span><br><span class="line"></span><br><span class="line">   next.handleRequest(req);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">printHandling</span><span class="params">(Request req)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  LOGGER.info(<span class="string">"&#123;&#125; 处理规则 \"&#123;&#125;\""</span>, <span class="keyword">this</span>, req);</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title">toString</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*请求对象 包含案件对象</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Request</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">final</span> RequestType requestType;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">final</span> YjAjxxtjInfo yjAjxxtjInfo;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">boolean</span> handled;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="title">Request</span><span class="params">(<span class="keyword">final</span> RequestType requestType, <span class="keyword">final</span> YjAjxxtjInfo yjAjxxtjInfo)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.requestType = Objects.requireNonNull(requestType);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.yjAjxxtjInfo = Objects.requireNonNull(yjAjxxtjInfo);</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">public</span> RequestType <span class="title">getRequestType</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> requestType;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">markHandled</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.handled = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isHandled</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.handled;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> requestType.getDesc();</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> *枚举规则匹配</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> \* <span class="doctag">@author</span> shengfq</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> \* <span class="doctag">@date</span> 2023-03-09</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> RequestType &#123;</span><br><span class="line"></span><br><span class="line"> WLADJZH,</span><br><span class="line"></span><br><span class="line"> WCXYEDJZH,</span><br><span class="line"></span><br><span class="line"> DJFFZSAZH,</span><br><span class="line"></span><br><span class="line"> DJJECGSAJE,</span><br><span class="line"></span><br><span class="line"> CFDJZH,</span><br><span class="line"></span><br><span class="line"> CADJ,</span><br><span class="line"></span><br><span class="line"> WABFSSXZ,</span><br><span class="line"></span><br><span class="line"> WYFJSJDZH,</span><br><span class="line"></span><br><span class="line"> CXWGZH,</span><br><span class="line"></span><br><span class="line"> FLWSNRQS;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> \* 定时任务执行器接口</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> \* */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IScheduleExecutor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   \* 获取待查的案件信息</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   \* */</span></span><br><span class="line"></span><br><span class="line">  <span class="function">List&lt;Request&gt; <span class="title">begin</span><span class="params">(YjAjxxtjInfo ajxxtjInfo)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   \* 责任链处理规则</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   \* */</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">handler</span><span class="params">(List&lt;Request&gt; requests)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   \* 将结果更新到统计记录表</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   \* yj_ajxxtj_info</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   \* */</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">end</span><span class="params">(YjAjxxtjInfo request)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> \* 定时任务类</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> \* */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScheduleExecutorTask</span> <span class="keyword">implements</span> <span class="title">IScheduleExecutor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line"></span><br><span class="line">  YjAjxxtjInfoService yjAjxxtjInfoService;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line"></span><br><span class="line">  ChainFactoryBuilder chainFactoryBuilder;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   *TODO 给目标案件添加预警规则匹配</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> List&lt;Request&gt; <span class="title">begin</span><span class="params">(YjAjxxtjInfo ajxxtjInfo)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">​    log.info(<span class="string">"获取待处理的案件信息 ajxxtjInfo&#123;&#125; "</span>,ajxxtjInfo);</span><br><span class="line"></span><br><span class="line">​    List&lt;Request&gt; requests=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">​    <span class="comment">//法律文书校验规则处理</span></span><br><span class="line"></span><br><span class="line">​    Request request=<span class="keyword">new</span> Request(RequestType.FLWSNRQS,ajxxtjInfo);</span><br><span class="line"></span><br><span class="line">​    <span class="comment">//TODO 有后续规则通过 新增 Request对象规则加入规则队列</span></span><br><span class="line"></span><br><span class="line">​    requests.add(request);</span><br><span class="line"></span><br><span class="line">​    <span class="keyword">return</span> requests;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   \* 责任链处理规则</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   \* */</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handler</span><span class="params">(List&lt;Request&gt; requests)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">​    log.info(<span class="string">"开始执行规则匹配"</span>);</span><br><span class="line"></span><br><span class="line">​    chainFactoryBuilder.makeRequest(requests);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   \* 将结果更新到统计记录表</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   \* yj_ajxxtj_info</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">end</span><span class="params">(YjAjxxtjInfo ajxxtjInfo)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">​    log.info(<span class="string">"完成预警规则匹配"</span>);</span><br><span class="line"></span><br><span class="line">​    <span class="keyword">int</span> result=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">​    <span class="keyword">if</span>(ajxxtjInfo!=<span class="keyword">null</span>)&#123;</span><br><span class="line"></span><br><span class="line">​      YjAjxxtjInfo update=<span class="keyword">new</span> YjAjxxtjInfo();</span><br><span class="line"></span><br><span class="line">​      update.setAjbh(ajxxtjInfo.getAjbh());</span><br><span class="line"></span><br><span class="line">​      update.setSfyj(QueryParamEnum.SFYJ_YES);</span><br><span class="line"></span><br><span class="line">​      result=yjAjxxtjInfoService.updateByAjbh(update);</span><br><span class="line"></span><br><span class="line">​    &#125;</span><br><span class="line"></span><br><span class="line">​    <span class="keyword">return</span> result;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> \* FlwsValidateHandler</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> *法律文书内容校验处理器</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FlwsValidateHandler</span> <span class="keyword">extends</span> <span class="title">RequestHandler</span></span>&#123;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Autowired</span></span><br><span class="line"></span><br><span class="line"> ZjckFlwsService zjckFlwsService;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleRequest</span><span class="params">(Request req)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(req.getRequestType()==RequestType.FLWSNRQS &amp;&amp; !req.isHandled())&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//规则匹配后的处理</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">super</span>.handleRequest(req);</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>实现心得</p>
<p>代码实现相对简单,但是将业务逻辑规则和控制任务代码进行了抽象隔离,符合OOP中的单一职责和开闭原则.控制线程还能很方便的放入到线程池中进行并发执行,提高了系统运行效率.也是将业务逻辑和控制逻辑解耦思想的体现.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.shengfq.github.io/2023/02/05/restful API 的设计之道/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="盛富强">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程序员shengfq">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2023/02/05/restful API 的设计之道/" itemprop="url">RESTFUL API 设计实践总结</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2023-02-05T00:00:00+08:00">
                2023-02-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://i.328888.xyz/2023/03/21/a2kFZ.png" alt="restful API 的设计之道"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.shengfq.github.io/2023/01/01/DTS数据迁移解决方案选型/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="盛富强">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程序员shengfq">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2023/01/01/DTS数据迁移解决方案选型/" itemprop="url">不同场景下数据迁移方案的选型分析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2023-01-01T00:00:00+08:00">
                2023-01-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>背景</p>
<p>公司在进行技术体系迁移,由原来的.net+sqlserver迁移到现在的java+mysql微服务体系.</p>
<p>这个大工程的实施是按子系统拆分逐步实现的,业务开发完后,通过流量网关切换流量到目标服务.由于服务之间的依赖,在现有运行期间,存在服务互相调用,数据互相同步的场景.这里着重说数据同步,数据迁移的解决方案.</p>
<p>上线方式是通过微服务逐步替换掉线上的.net服务,而原有.net体系内还有数据依赖,停掉.net服务后,数据还要从mysql同步回写到sqlserver.当依赖的服务也被替换下线后,数据同步服务就需要下线,不能依赖业务.为此,我从全量迁移,增量迁移,业务强依赖三个指标展开.ETL加载策略(增量/全量/流式)</p>
<p>场景一.对业务逻辑依赖性强,同步服务发生在单条数据修改时需要同步,方式灵活,对数据自定义要求较高.</p>
<p>解决方案:dts(数据传输服务)</p>
<p>优点:DTS服务是java微服务,主要是通过消费rabbitmq消息通知实现数据同步请求,client端在业务代码中插入consumer代码,所有的数据同步消息都会集中到rabbitmq中,由dts逐步消费,及时服务挂了,rabbitmq也能缓存这些未做任务.</p>
<p>缺点:dts的性能要求较高,在实际生产环境中,经常出现dts服务宕机,尤其是在同步高峰期,dts的流量经常被打满.因为dts消费完消息后,要往各个数据源同步执行CRUD操作.频繁的建立和销毁连接.</p>
<p>场景二.对业务逻辑依赖弱.跨数据源,实时性要求低,快速实现表的全量同步.</p>
<p>解决方案:datax(离线数据全量同步)</p>
<p>优点:适合基础字典表,例如类目,栏目或者被依赖的数据字典表同步,由datax job执行脚本,可以编写复杂的SQL同步语句,程序自定义程度强,较为灵活,支持主流的数据源,跨平台跨语言,其设置的schedule模式后,无需人工干预自动执行,后期服务下线也方便,支持多job执行模式.</p>
<ul>
<li>实现包括 MySQL、Oracle、SqlServer、Postgre、HDFS、Hive、ADS、HBase、TableStore(OTS)、MaxCompute(ODPS)、DRDS 等各种异构数据源之间高效的数据同步功能。</li>
</ul>
<p>缺点:同步实时性不强,基于存量数据的同步.</p>
<p>场景三:对业务逻辑依赖弱,跨数据源,实时性要求高,快速实现表的增量同步</p>
<p>解决方案:alibaba canal(在线数据增量同步)</p>
<p>优点:实时性强,基于mysql的binlog日志流读取,同步到其他数据源,方便业务无关性,通常无需程序员介入.</p>
<p>缺点:实时性要求对性能要求较高,在非集群模式下,单台服务8G内存,10个管道就有点吃不消了.</p>
<p>参考文档</p>
<p><a href="https://developer.aliyun.com/article/1045779" target="_blank" rel="noopener">datax教程-入门</a></p>
<p><a href="https://blog.csdn.net/maomaosi2009/category_10342136.html" target="_blank" rel="noopener">streamset教程</a></p>
<p><a href="https://notomato.blog.csdn.net/article/details/110635508" target="_blank" rel="noopener">常用的ETL工具方法</a></p>
<p><a href="https://github.com/alibaba/canal" target="_blank" rel="noopener">alibaba canal</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.shengfq.github.io/2022/11/12/如何解决毫无头绪的线上问题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="盛富强">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程序员shengfq">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022/11/12/如何解决毫无头绪的线上问题/" itemprop="url">如何解决毫无头绪的线上问题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-11-12T00:00:00+08:00">
                2022-11-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>线上问题分类:功能性问题,性能性问题.也就是说,一个能直接看到症状,一个看不到症状.</p>
<p>按医学诊断流程:判断科目,收集指标,分析指标,预判故障,验证故障,解决原理,给出方案,实施方案,检查结果.</p>
<p>一.收集信息</p>
<p>能直接看到症状的问题都不是大问题,基本上可以通过日志,梳理流程,判断是哪部分出现的bug.</p>
<p>看不到症状的问题,比如响应时间越来越长,QPS越来越低,隔三差五就宕机.这种非功能性的bug.对问题进行分类:</p>
<p>是否资源不够用? CPU/内存/磁盘/数据库/网络带宽/JVM堆内存.</p>
<p>为什么不够用?初始太小?逐步填满?没有释放?就需要一个检测工具对当前的系统进行分析.</p>
<p>常用的有visualvm/arthas/jstack/jconsole.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.shengfq.github.io/2022/08/29/elastic search 全文检索知识学习/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="盛富强">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程序员shengfq">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022/08/29/elastic search 全文检索知识学习/" itemprop="url">elastic search 全文检索知识学习</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-08-29T00:00:00+08:00">
                2022-08-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="如何自学一门中间件"><a href="#如何自学一门中间件" class="headerlink" title="如何自学一门中间件"></a>如何自学一门中间件</h2><p>1.去官网找文档,guide/reference/api,文档通读一遍,搞清楚是什么?</p>
<p>2.不要去看源码,而是先demo一遍,知道流程和步骤,抽象模型,核心组件,运作原理.搞清楚为什么工具能达到目的?</p>
<p>3.场景是什么?结合场景和demo练习几次,想想是怎么回事?如何做到的?</p>
<p>4.越是低版本越是接近底层原理,越是接近底层就越能弄明白,其他API无非就是各语言的扩展.比如掌握了命令行,其他语言API就不用记</p>
<h2 id="class1-es安装-配置"><a href="#class1-es安装-配置" class="headerlink" title="class1 es安装,配置"></a>class1 es安装,配置</h2><p>1.图形化工具 elastic search head,kibana</p>
<h2 id="class2-es的基本概念"><a href="#class2-es的基本概念" class="headerlink" title="class2 es的基本概念"></a>class2 es的基本概念</h2><p>集群,节点</p>
<p>索引,类型,文档,分片,映射</p>
<table>
<thead>
<tr>
<th>关系型数据库(mysql)</th>
<th>面向文档elasticsearch</th>
</tr>
</thead>
<tbody>
<tr>
<td>database</td>
<td>indices</td>
</tr>
<tr>
<td>tables</td>
<td>types</td>
</tr>
<tr>
<td>rows</td>
<td>documents</td>
</tr>
<tr>
<td>dolumns</td>
<td>fields</td>
</tr>
</tbody>
</table>
<p>逻辑设计:</p>
<p>一个索引类型中,包含多个文档,当我们索引一篇文档时,可以通过这样的规则: 索引&gt;类型&gt;文档id,通过这个组合我们能索引到具体的文档.</p>
<p>索引</p>
<p>文档</p>
<p>文档包含字段和值,可以层级包含字段和值,JSON格式.</p>
<p>字段类型</p>
<p>类型是包含文档的上级节点,类型中对字段的定义是映射</p>
<p><strong>==倒排索引??==</strong></p>
<h2 id="class3-ik分词器详解"><a href="#class3-ik分词器详解" class="headerlink" title="class3 ik分词器详解"></a>class3 ik分词器详解</h2><blockquote>
<p>安装分词器插件 :</p>
</blockquote>
<p>ik_smart 最细粒度划分 / ik_max_word   穷尽词库可能</p>
<p>elastic search analysis ik</p>
<blockquote>
<p>安装kibana</p>
</blockquote>
<blockquote>
<p>查看分词器效果</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">kibana</span><br><span class="line"></span><br><span class="line">GET _analyze&#123;</span><br><span class="line"></span><br><span class="line">&quot;analyzer&quot;:&quot;ik_smart&quot;,</span><br><span class="line"></span><br><span class="line">&quot;text&quot;:&quot;中国共产党人&quot;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>自定义分词器插件</p>
</blockquote>
<p>自己加字典,如何自己加字典?</p>
<p>添加字典:xxx.dic</p>
<p>修改到: ${es_plugins}/ik/config/IkAnalyzer.cfg.xml</p>
<h2 id="class4-rest-分格的API"><a href="#class4-rest-分格的API" class="headerlink" title="class4 rest 分格的API"></a>class4 rest 分格的API</h2><p>数据类型</p>
<p>添加文档字段时,可以指定也可以不指定数据类型</p>
<p>字符串类型</p>
<p>text,keyword</p>
<p>数值类型</p>
<p>long,integer,short,byte,double,float,half_float</p>
<p>日期类型</p>
<p>date</p>
<p>boolean类型</p>
<p>boolean</p>
<p>二进制类型</p>
<p>binary </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">建立索引的数据结构存储规则</span><br><span class="line">put http://127.0.0.1:9200/&#123;index&#125;</span><br><span class="line">&#123;</span><br><span class="line">&quot;mappings&quot;:&#123;</span><br><span class="line">	&quot;properties&quot;:&#123;</span><br><span class="line">		&quot;name&quot;:&#123;</span><br><span class="line">			&quot;type&quot;:&quot;text&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;age&quot;:&#123;</span><br><span class="line">			&quot;type&quot;:&quot;long&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;birthday&quot;:&#123;</span><br><span class="line">			&quot;type&quot;:&quot;date&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="索引的操作API"><a href="#索引的操作API" class="headerlink" title="索引的操作API"></a>索引的操作API</h3><table>
<thead>
<tr>
<th>http method</th>
<th style="text-align:left">name</th>
<th>url</th>
<th>param</th>
</tr>
</thead>
<tbody>
<tr>
<td>put</td>
<td style="text-align:left">创建一个索引,添加规则</td>
<td><a href="http://127.0.0.1:9200/{index}" target="_blank" rel="noopener">http://127.0.0.1:9200/{index}</a></td>
<td>json body</td>
</tr>
<tr>
<td>get</td>
<td style="text-align:left">查看所有索引</td>
<td><a href="http://127.0.0.1:9200/_cat/indices?v" target="_blank" rel="noopener">http://127.0.0.1:9200/_cat/indices?v</a></td>
<td></td>
</tr>
<tr>
<td>get</td>
<td style="text-align:left"></td>
<td>_cat/xxx</td>
<td></td>
</tr>
<tr>
<td>get</td>
<td style="text-align:left"></td>
<td>-cluster/xxx</td>
<td></td>
</tr>
<tr>
<td>get</td>
<td style="text-align:left">查看单个索引</td>
<td><a href="http://127.0.0.1:9200/{index}" target="_blank" rel="noopener">http://127.0.0.1:9200/{index}</a></td>
<td></td>
</tr>
<tr>
<td>delete</td>
<td style="text-align:left">删除一个索引</td>
<td><a href="http://127.0.0.1:9200/{index}" target="_blank" rel="noopener">http://127.0.0.1:9200/{index}</a></td>
<td></td>
</tr>
<tr>
<td>post</td>
<td style="text-align:left">创建一个默认文档</td>
<td><a href="http://127.0.0.1:9200/{index}/_doc" target="_blank" rel="noopener">http://127.0.0.1:9200/{index}/_doc</a></td>
<td></td>
</tr>
<tr>
<td>get</td>
<td style="text-align:left">查看默认文档</td>
<td><a href="http://127.0.0.1:9200/{index}/_doc/{doc_id}" target="_blank" rel="noopener">http://127.0.0.1:9200/{index}/_doc/{doc_id}</a></td>
<td></td>
</tr>
<tr>
<td>put</td>
<td style="text-align:left">修改默认文档[不建议] 覆盖式</td>
<td><a href="http://127.0.0.1:9200/{index}/_doc/{doc_id}" target="_blank" rel="noopener">http://127.0.0.1:9200/{index}/_doc/{doc_id}</a></td>
<td></td>
</tr>
<tr>
<td>post</td>
<td style="text-align:left">修改默认文档[单字段修改]</td>
<td><a href="http://127.0.0.1:9200/{index}/_doc/{doc_id}/__update" target="_blank" rel="noopener">http://127.0.0.1:9200/{index}/_doc/{doc_id}/__update</a></td>
<td></td>
</tr>
<tr>
<td>delete</td>
<td style="text-align:left">删除默认文档</td>
<td><a href="http://127.0.0.1:9200/{index}/_doc/{doc_id}" target="_blank" rel="noopener">http://127.0.0.1:9200/{index}/_doc/{doc_id}</a></td>
</tr>
</tbody>
</table>
<h3 id="文档的操作API"><a href="#文档的操作API" class="headerlink" title="文档的操作API"></a>文档的操作API</h3><table>
<thead>
<tr>
<th>http method</th>
<th>name</th>
<th>url</th>
<th>param</th>
</tr>
</thead>
<tbody>
<tr>
<td>put</td>
<td>创建文档</td>
<td><a href="http://127.0.0.1:9200/{index}/{type}/{document_id}" target="_blank" rel="noopener">http://127.0.0.1:9200/{index}/{type}/{document_id}</a></td>
<td></td>
</tr>
<tr>
<td>post</td>
<td>创建随机id文档</td>
<td><a href="http://127.0.0.1:9200/{index}/{type}" target="_blank" rel="noopener">http://127.0.0.1:9200/{index}/{type}</a></td>
<td></td>
</tr>
<tr>
<td>get</td>
<td>获取文档</td>
<td><a href="http://127.0.0.1:9200/{index}/{type}/{document_id}" target="_blank" rel="noopener">http://127.0.0.1:9200/{index}/{type}/{document_id}</a></td>
<td></td>
</tr>
<tr>
<td>post</td>
<td>更新文档字段</td>
<td><a href="http://127.0.0.1:9200/{index}/{type}/{doc_id}/__update" target="_blank" rel="noopener">http://127.0.0.1:9200/{index}/{type}/{doc_id}/__update</a></td>
<td></td>
</tr>
<tr>
<td>get</td>
<td>简单匹配查询文档</td>
<td><a href="http://127.0.0.1:9200/{index}/{type}/_search" target="_blank" rel="noopener">http://127.0.0.1:9200/{index}/{type}/_search</a></td>
<td></td>
</tr>
<tr>
<td>delete</td>
<td>删除文档</td>
<td><a href="http://127.0.0.1:9200/{index}/{type}/{document_id}" target="_blank" rel="noopener">http://127.0.0.1:9200/{index}/{type}/{document_id}</a></td>
<td></td>
</tr>
<tr>
<td>delete</td>
<td>条件删除文档</td>
<td><a href="http://127.0.0.1:9200/{index}/{type}/_delete_by_query" target="_blank" rel="noopener">http://127.0.0.1:9200/{index}/{type}/_delete_by_query</a></td>
<td></td>
</tr>
<tr>
<td>get</td>
<td>查询所有文档</td>
<td><a href="http://127.0.0.1:9200/{index}/{type}/_search" target="_blank" rel="noopener">http://127.0.0.1:9200/{index}/{type}/_search</a></td>
<td>参数不同</td>
</tr>
<tr>
<td>get</td>
<td>字段匹配查询</td>
<td><a href="http://127.0.0.1:9200/{index}/{type}/_search" target="_blank" rel="noopener">http://127.0.0.1:9200/{index}/{type}/_search</a></td>
<td>参数不同</td>
</tr>
<tr>
<td>get</td>
<td>关键字精确查询</td>
<td><a href="http://127.0.0.1:9200/{index}/{type}/_search" target="_blank" rel="noopener">http://127.0.0.1:9200/{index}/{type}/_search</a></td>
<td>参数不同</td>
</tr>
<tr>
<td>get</td>
<td>多关键字精确查询</td>
<td><a href="http://127.0.0.1:9200/{index}/{type}/_search" target="_blank" rel="noopener">http://127.0.0.1:9200/{index}/{type}/_search</a></td>
<td>参数不同</td>
</tr>
<tr>
<td>get</td>
<td>指定查询字段</td>
<td><a href="http://127.0.0.1:9200/{index}/{type}/_search" target="_blank" rel="noopener">http://127.0.0.1:9200/{index}/{type}/_search</a></td>
<td></td>
</tr>
<tr>
<td>get</td>
<td>过滤字段</td>
<td><a href="http://127.0.0.1:9200/{index}/{type}/_search" target="_blank" rel="noopener">http://127.0.0.1:9200/{index}/{type}/_search</a></td>
<td></td>
</tr>
<tr>
<td>get</td>
<td>组合查询</td>
<td><a href="http://127.0.0.1:9200/{index}/{type}/_search" target="_blank" rel="noopener">http://127.0.0.1:9200/{index}/{type}/_search</a></td>
<td></td>
</tr>
<tr>
<td>get</td>
<td>范围查询</td>
<td><a href="http://127.0.0.1:9200/{index}/{type}/_search" target="_blank" rel="noopener">http://127.0.0.1:9200/{index}/{type}/_search</a></td>
<td></td>
</tr>
<tr>
<td>get</td>
<td>模糊查询</td>
<td><a href="http://127.0.0.1:9200/{index}/{type}/_search" target="_blank" rel="noopener">http://127.0.0.1:9200/{index}/{type}/_search</a></td>
<td></td>
</tr>
<tr>
<td>get</td>
<td>单字段排序</td>
<td><a href="http://127.0.0.1:9200/{index}/{type}/_search" target="_blank" rel="noopener">http://127.0.0.1:9200/{index}/{type}/_search</a></td>
<td></td>
</tr>
<tr>
<td>get</td>
<td>多字段排序</td>
<td><a href="http://127.0.0.1:9200/{index}/{type}/_search" target="_blank" rel="noopener">http://127.0.0.1:9200/{index}/{type}/_search</a></td>
<td></td>
</tr>
<tr>
<td></td>
<td>高亮查询</td>
<td><a href="http://127.0.0.1:9200/{index}/{type}/_search" target="_blank" rel="noopener">http://127.0.0.1:9200/{index}/{type}/_search</a></td>
<td>highlight</td>
</tr>
<tr>
<td></td>
<td>分页查询</td>
<td><a href="http://127.0.0.1:9200/{index}/{type}/_search" target="_blank" rel="noopener">http://127.0.0.1:9200/{index}/{type}/_search</a></td>
<td></td>
</tr>
<tr>
<td></td>
<td>聚合查询</td>
<td><a href="http://127.0.0.1:9200/{index}/{type}/_search" target="_blank" rel="noopener">http://127.0.0.1:9200/{index}/{type}/_search</a></td>
<td></td>
</tr>
<tr>
<td></td>
<td>桶聚合查询</td>
<td><a href="http://127.0.0.1:9200/{index}/{type}/_search" target="_blank" rel="noopener">http://127.0.0.1:9200/{index}/{type}/_search</a></td>
</tr>
</tbody>
</table>
<h3 id="映射操作API"><a href="#映射操作API" class="headerlink" title="映射操作API"></a>映射操作API</h3><table>
<thead>
<tr>
<th>ttp method</th>
<th>name</th>
<th>url</th>
<th>param</th>
</tr>
</thead>
<tbody>
<tr>
<td>put</td>
<td>添加映射</td>
<td><a href="http://127.0.0.1:9200/{index}/_mapping" target="_blank" rel="noopener">http://127.0.0.1:9200/{index}/_mapping</a></td>
<td></td>
</tr>
<tr>
<td>get</td>
<td>查看映射</td>
<td><a href="http://127.0.0.1:9200/{index}/_mapping" target="_blank" rel="noopener">http://127.0.0.1:9200/{index}/_mapping</a></td>
<td></td>
</tr>
<tr>
<td>put</td>
<td>索引映射关联</td>
<td><a href="http://127.0.0.1:9200/{index}/{type}/{doc_id}/__update" target="_blank" rel="noopener">http://127.0.0.1:9200/{index}/{type}/{doc_id}/__update</a></td>
</tr>
</tbody>
</table>
<p>分词器类型</p>
<h3 id="java-rest-client-API"><a href="#java-rest-client-API" class="headerlink" title="java rest client API"></a>java rest client API</h3><p>集成思路:</p>
<p>一.java rest sdk就是运用java httpclient把原始的命令行工具封装到request/response/client框架内,每个命令一组request/response,这是一个典型的http restful请求java框架. jar名称:elasticsearch-rest-high-level-client.jar,核心操作对象:TransportClient.java/RestHighLevelClient.java</p>
<p>二.要想跟spring集成,就是把对象实例托管到Context中,spring有spring-data.jar抽象,为elasticsearch提供具体的实现:spring-data-elasticsearch.jar, 核心操作对象:ElasticsearchRestTemplate.java</p>
<p>三.为了能实现自动化配置,用户无需做对象实例化,跟springboot集成autoconfigure模块,springboot把elasticsearch集成到了autoconfigure中,jar名称:spring-boot-starter-data-elasticsearch.jar,核心操作对象没变,只需要在application.yml中配置es的连接信息,就能直接使用elasticsearchRestTemplate.java</p>
<h2 id="class5-springboot集成es"><a href="#class5-springboot集成es" class="headerlink" title="class5 springboot集成es"></a>class5 springboot集成es</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">自动配置包:</span><br><span class="line">maven:</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-data-elasticsearch&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"> </span><br><span class="line">spring-boot-autoconfigure.jar</span><br><span class="line"></span><br><span class="line">核心包</span><br><span class="line">springframework.boot.autoconfigure.data.elasticsearch</span><br><span class="line">核心类</span><br><span class="line">RestHightLevelClient.java</span><br><span class="line">RestLevelClientConfiguration.java</span><br></pre></td></tr></table></figure>
<h2 id="class6-京东爬虫入库es-全文检索"><a href="#class6-京东爬虫入库es-全文检索" class="headerlink" title="class6 京东爬虫入库es,全文检索"></a>class6 京东爬虫入库es,全文检索</h2><h3 id="爬虫"><a href="#爬虫" class="headerlink" title="爬虫"></a>爬虫</h3><p>1.写爬虫,根据京东搜索关键字的url去加载查询结果,放到list中.</p>
<p>2.将搜索到结果加入到es的文档库.输入关键字,返回添加是否成功.</p>
<p>3.获取这些数据实现搜索功能,关键字,分页,返回列表.</p>
<p>/条件搜索/ searchRequest  SearchSourceBuilder</p>
<p>/分页 sourcebuilder.from(); size()</p>
<p>/精准匹配 TermQueryBuilder  sourcebuilder.query(tempquerybuilder); sourcebuilder.timeout</p>
<p>//高亮关键字</p>
<p>/执行搜索 </p>
<p>searchRequest.source(sourcebuilder);</p>
<p>client.search(request,requestOptions.default); //SearchResponse</p>
<p>//解析结果</p>
<p>SearchResponse.getHits().getHits().getSourceAsMap();//Map&lt;String,Object&gt;</p>
<h3 id="搜索高亮"><a href="#搜索高亮" class="headerlink" title="搜索高亮"></a>搜索高亮</h3><p>​    高亮关键字/执行搜索/解析结果 //将原来字段替换为高亮的字段</p>
<p>举一反三</p>
<p>要做搜索,只需要把MySQL的数据加入到es,实现搜索全文高亮就行.</p>
<h4 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h4><p>1.服务启动后es连接失败</p>
<p>java.net.ConnectException: Connection refused</p>
<p>原因:client的jar包版本与server的版本不匹配导致连接失败.client是7.x 而我的服务是6.x</p>
<p>2.批量添加报错:</p>
<p>nested exception is org.elasticsearch.action.ActionRequestValidationException: Validation Failed: 1: type is missing;2: type is missing;3: type is missing;4: type is missing;5: type is missing;6: type is missing;7: type is missing</p>
<p>原因:6.x版本的es,插入索引需要 指定type,7.x之后就不需要了,这是版本差异.</p>
<p>index/type/doc_id</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>1.es的发展历史</p>
<p>2.es的文件结构</p>
<p>3.安装es</p>
<p>4.生态圈,logstash,kibana</p>
<p>5.分词器ik,自定义分词器</p>
<p>6.restful API操作</p>
<p>7.javaAPI操作</p>
<p>8.springboot集成elasticsearch</p>
<p>9.爬虫爬取jd的关键字搜索</p>
<p>10.模拟全文检索</p>
<p>爬虫-&gt;加入es库-&gt;搜索es库返回list-&gt;高亮显示返回关键字</p>
<p>参考资料</p>
<p><a href="https://szh-forever-young.blog.csdn.net/article/details/119930308?spm=a2c6h.12873639.article-detail.16.1c905a31NBbdOi#t9" target="_blank" rel="noopener">使用Java API实现ES中的索引、映射、文档操作</a></p>
<p><a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/_how_to_read_this_book.html" target="_blank" rel="noopener">低版本的elasticsearch中文 guide</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.shengfq.github.io/2022/08/02/springboot+mybatis+mybatisplus多数据源解决方案/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="盛富强">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程序员shengfq">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022/08/02/springboot+mybatis+mybatisplus多数据源解决方案/" itemprop="url">springboot多数据源实现</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-08-02T00:00:00+08:00">
                2022-08-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4>一.多数据库实例集成</h4>

<p>原理:</p>
<p>springboot支持与mybatis和mybatis-plus的快速自动化配置starter.</p>
<p>需要初始化定制<b>DataSource</b>,<b>DataSourceTransactionManager</b>,<b>SqlSessionFactory</b>三个对象的实例化.</p>
<p>基于扫描不同package下的mapper和mapper.xml创建上述的实例.</p>
<p>其他service层/mapper层跟单独数据源操作写法相同.只是要注意,这是通过package来隔离不同datasource,所以最好把不同的DataSource操作的service/mapper/entity放到各自的业务package中.</p>
<p>案例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">main/java</span><br><span class="line">com.mybatis.spring.demo</span><br><span class="line">	cms</span><br><span class="line">		entity</span><br><span class="line">		mapper</span><br><span class="line">		service</span><br><span class="line">	open</span><br><span class="line">		entity</span><br><span class="line">		mapper</span><br><span class="line">		service</span><br><span class="line">main/resources</span><br><span class="line">	mapper</span><br><span class="line">		cms</span><br><span class="line">			xxxMapper.xml</span><br><span class="line">		open</span><br><span class="line">			yyyMapper.xml</span><br></pre></td></tr></table></figure>
<p>单数据源实例化方式:只需要配置:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//application.properties</span><br><span class="line">spring.datasource.url=xxx</span><br><span class="line">spring.datasource.username=xxx</span><br><span class="line">spring.datasource.password=xxx</span><br><span class="line">spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver</span><br></pre></td></tr></table></figure>
<p>而多数据源实例话方式需要配置各个数据源的jdbc连接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//application.properties</span><br><span class="line">spring.datasource.cms.url=jdbc:mysql:xxx</span><br><span class="line">spring.datasource.cms.username=xxx</span><br><span class="line">spring.datasource.cms.password=xxx</span><br><span class="line">spring.datasource.cms.driver-class-name=com.mysql.cj.jdbc.Driver</span><br><span class="line"></span><br><span class="line">spring.datasource.open.url=jdbc:mysql:xxx</span><br><span class="line">spring.datasource.open.username=xxx</span><br><span class="line">spring.datasource.open.password=xxx</span><br><span class="line">spring.datasource.open.driver-class-name=com.mysql.cj.jdbc.Driver</span><br></pre></td></tr></table></figure>
<p>创建数据源配置类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * MyBatis 在 SpringBoot 中动态多数据源配置</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> sheng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022-08-02</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"spring.datasource.open"</span>)</span><br><span class="line"><span class="meta">@MapperScan</span>(basePackages = <span class="string">"com.mybatis.spring.demo.open.mapper"</span>, sqlSessionFactoryRef = <span class="string">"openSqlSessionFactory"</span>)</span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OpenDbConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DBProperties dbProperties;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 数据库配置息信息</span></span><br><span class="line">    <span class="keyword">private</span> String driverClassName;</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"openDataSource"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">unionDataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        HikariDataSource dataSource = <span class="keyword">new</span> HikariDataSource();</span><br><span class="line">        <span class="comment">// 设置数据源信息</span></span><br><span class="line">        dataSource.setDriverClassName(driverClassName);</span><br><span class="line">        dataSource.setJdbcUrl(url);</span><br><span class="line">        dataSource.setUsername(username);</span><br><span class="line">        dataSource.setPassword(password);</span><br><span class="line">        <span class="comment">// 公共属性配置</span></span><br><span class="line">        dataSource.setMinimumIdle(dbProperties.getMinimumIdle());</span><br><span class="line">        dataSource.setIdleTimeout(dbProperties.getIdleTimeout());</span><br><span class="line">        dataSource.setMaximumPoolSize(dbProperties.getMaximumPoolSize());</span><br><span class="line">        dataSource.setAutoCommit(dbProperties.isAutoCommit());</span><br><span class="line">        dataSource.setPoolName(<span class="string">"open_"</span> + dbProperties.getPoolName());</span><br><span class="line">        dataSource.setMaxLifetime(dbProperties.getMaxLifetime());</span><br><span class="line">        dataSource.setConnectionTimeout(dbProperties.getConnectionTimeout());</span><br><span class="line">        dataSource.setConnectionTestQuery(dbProperties.getConnectionTestQuery());</span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * union 事务管理器</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Role</span>(<span class="number">100</span>)</span><br><span class="line">    <span class="meta">@Bean</span>(name = CmsConst.TRANSACTION_OPEN)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSourceTransactionManager <span class="title">unionTransactionManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DataSourceTransactionManager(unionDataSource());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * unionDataSource Session工厂类</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dataSource</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"openSqlSessionFactory"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> SqlSessionFactory <span class="title">unionSqlSessionFactory</span><span class="params">(@Qualifier(<span class="string">"openDataSource"</span>)</span> DataSource dataSource)</span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="comment">//如果是与mybatis-plus集成就需要使用MybatisSqlSessionFactoryBean来代理实例化SqlSessionFactory</span></span><br><span class="line">        MybatisSqlSessionFactoryBean sessionFactory = <span class="keyword">new</span> MybatisSqlSessionFactoryBean();</span><br><span class="line">        sessionFactory.setDataSource(dataSource);</span><br><span class="line">        MybatisConfiguration config = <span class="keyword">new</span> MybatisConfiguration();</span><br><span class="line">        config.setMapUnderscoreToCamelCase(<span class="keyword">true</span>);</span><br><span class="line">        sessionFactory.setConfiguration(config);</span><br><span class="line">        <span class="comment">//如果不使用xml的方式配置mapper，则可以省去下面这行mapper location的配置。</span></span><br><span class="line">        sessionFactory.setMapperLocations(<span class="keyword">new</span> PathMatchingResourcePatternResolver().getResources(<span class="string">"classpath*:mapper/open/*.xml"</span>));</span><br><span class="line">        <span class="keyword">return</span> sessionFactory.getObject();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>同理,其他的数据源配置文件只需要修改</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//配置参数前缀</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"spring.datasource.cms"</span>)</span><br><span class="line"><span class="comment">//扫描包路径</span></span><br><span class="line"><span class="meta">@MapperScan</span>(basePackages = <span class="string">"com.mybatis.spring.demo.cms.mapper"</span>, sqlSessionFactoryRef = <span class="string">"cmsSqlSessionFactory"</span>)</span><br><span class="line"><span class="comment">//Xml文件路径</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//如果不使用xml的方式配置mapper，则可以省去下面这行mapper location的配置。</span></span><br><span class="line">        sessionFactory.setMapperLocations(<span class="keyword">new</span> PathMatchingResourcePatternResolver().getResources(<span class="string">"classpath*:mapper/cms/*.xml"</span>));</span><br></pre></td></tr></table></figure>
<p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>FAQ问题</p>
<p>1.Spring Boot集成MyBatis报错：Invalid bound statement (not found)…解决方案</p>
<p>无法识别mybatis-plus包的BaseMapper通用CURD方法</p>
<p>一.SqlSessionFactory不要使用原生的，请使用MybatisSqlSessionFactory</p>
<p>2.自定义 SQL 无法执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">application.properties</span><br><span class="line">##mybatis-plus mapper xml 文件地址</span><br><span class="line">mybatis-plus.mapper-locations= classpath*:/mapper/**/*Mapper.xml</span><br><span class="line">##mybatis-plus type-aliases 文件地址</span><br><span class="line">mybatis-plus.type-aliases-package= com.mybatis.spring.demo</span><br></pre></td></tr></table></figure>
<p>参考资料</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.shengfq.github.io/2022/05/15/编程思维-抽象思维训练方法论/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="盛富强">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程序员shengfq">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022/05/15/编程思维-抽象思维训练方法论/" itemprop="url">编程思维-抽象思维训练方法论</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-05-15T00:00:00+08:00">
                2022-05-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h5>程序员必备的思维能力：抽象思维</h5>

<p>转载自: 原文 <a href="https://mp.weixin.qq.com/s/cJ0odiYcphhNBoAVjqpCZQ" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/cJ0odiYcphhNBoAVjqpCZQ</a></p>
<blockquote>
<p>若想捉大鱼，就得潜入深渊。深渊里的鱼更有力，也更纯净。硕大而抽象，且非常美丽。——大卫·林奇</p>
</blockquote>
<p>抽象思维是我们工程师最重要的思维能力。因为软件技术 本质上就是一门抽象的艺术。我们的工作是存思维的“游戏”，虽然我们在使用键盘、显示器，打开电脑可以看到主板、硬盘等硬件。但我们即看不到程序如何被执行，也看不到0101是如何被CPU处理的。</p>
<p>我们工程师每天都要动用抽象思维，对问题域进行分析、归纳、综合、判断、推理。从而抽象出各种概念，挖掘概念和概念之间的关系，对问题域进行建模，然后通过编程语言实现业务功能。所以，我们大部分的时间并不是在写代码，而是在梳理需求，理清概念，当然，也包括尝试看懂那些“该死的、别人写的”代码。</p>
<p>在我接触的工程师中，能深入理解抽象概念的并不多，能把抽象和面向对象、架构设计进行有机结合，能用抽象思维进行问题分析、化繁为简的同学更是凤毛麟角。</p>
<p>对于我本人而言，每当我对抽象有进一步的理解和认知，我都能切身感受到它给我在编码和设计上带来的质的变化。同时感慨之前对抽象的理解为什么如此肤浅。如果时间可以倒流的话，我希望我在我职业生涯的早期，就能充分意识到抽象的重要性，能多花时间认真的研究它，深刻的理解它，这样应该可以少走很多弯路。</p>
<h1 id="1-1-什么是抽象"><a href="#1-1-什么是抽象" class="headerlink" title="1.1 什么是抽象"></a>1.1 什么是抽象</h1><p>关于抽象的定义，百度百科是这样说的：</p>
<blockquote>
<p>抽象是从众多的事物中抽取出共同的、本质性的特征，而舍弃其非本质的特征的过程。具体地说，抽象就是人们在实践的基础上，对于丰富的感性材料通过去粗取精、去伪存真、由此及彼、由表及里的加工制作，形成概念、判断、推理等思维形式，以反映事物的本质和规律的方法。<br>实际上，抽象是与具体相对应的概念，具体是事物的多种属性的总和，因而抽象亦可理解为由具体事物的多种属性中舍弃了若干属性而固定了另一些属性的思维活动。[1]</p>
</blockquote>
<p>Wikipedia的解释是：</p>
<blockquote>
<p>抽象是指为了某种目的，对一个概念或一种现象包含的信息进行过滤，移除不相关的信息，只保留与某种最终目的相关的信息。例如，一个皮质的足球，我们可以过滤它的质料等信息，得到更一般性的概念，也就是球。从另外一个角度看，抽象就是简化事物，抓住事物本质的过程。[2]</p>
</blockquote>
<p>简单而言，“抽”就是抽离，“象”就是具象，字面上理解抽象，抽象的过程就是从“具象”事物中归纳出共同特征，“抽取”得到一般化（Generalization）的概念的过程。英文的抽象——abstract来自拉丁文abstractio，它的原意是排除、抽出。</p>
<p>为了更好的方便你理解抽象，让我们先来看一幅毕加索的画，如下图所示，图的左边是一头水牛，是具象的，右边是毕加索画，是抽象的。怎么样，是不是感觉自己一下子理解了抽象画的含义。 <img src="https://mmbiz.qpic.cn/mmbiz_png/iadkjxbLay4icWxjfM8Zo7y2icbjLiapvwzJjbcuCCn581lnvdod3lazYEJHaAVwcp3RvWjx25jnNCQufWk2EEl6pA/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>可以看到，抽象牛只有几根线条，不过这几根线条是做了高度抽象之后的线条，过滤了水牛的绝大部分细节，保留了牛最本质特征，比如牛角，牛头，牛鞭、牛尾巴等等。这种对细节的舍弃使得“抽象牛”具有更好的泛化（Generalization）能力。可以说，抽象更接近问题的本质。也就是说所有的牛都逃不过这几根线条。</p>
<h1 id="1-2-抽象和语言是一体的"><a href="#1-2-抽象和语言是一体的" class="headerlink" title="1.2 抽象和语言是一体的"></a>1.2 抽象和语言是一体的</h1><p>关于抽象思维，我们在百度百科上可以看到如下的定义：</p>
<blockquote>
<p>抽象思维，又称词（概念）的思维或者逻辑思维，是指用词（概念）进行判断、推理并得出结论的过程。抽象思维以词（概念）为中介来反映现实。这是思维的最本质特征，也是人的思维和动物心理的根本区别。[3]</p>
</blockquote>
<p>之所以把抽象思维称为词思维或者概念思维，是因为语言和抽象是一体的。当我们说“牛”的时候，说的就是“牛”的抽象，他代表了所有牛共有的特征。同样，当你在程序中创建Cow这个类的时候，道理也是一样。在生活中，我们只见过一头一头具象的牛，“牛”作为抽象的存在，即看不见也摸不着。</p>
<p>这种把抽象概念作为世界本真的看法，也是古希腊哲学家柏拉图的最重要哲学思想。柏拉图认为，我们所有用感觉感知到的事物，都源于相应的理念。他认为具体事物的“名”，也就是他说的“理念世界”才是本真的东西，具体的一头牛，有大有小，有公有母，颜色、性情、外形各自不同。因此我们不好用个体感觉加以概括，但是这些牛既然都被统称为“牛”，则说明它们必然都源于同一个“理念”，即所谓“牛的理念”或者“理念的牛”，所以它们可以用“牛”加以概括。尚且不论“理念世界”是否真的存在，这是一个哲学问题，但有一点可以确定，我们的思考，对概念的表达都离不开语言。[4]</p>
<p>这也是为什么，我在做设计和代码审查（Code Review）的时候，会特别关注命名是否合理的原因。因为命名的好坏，在很大程度上反应了我们对一个概念的思考是否清晰，我们的抽象是否合理，反应在代码上就是，代码的可读性、可理解性是不是良好，以及我们的设计是不是到位。</p>
<p>有人做过一个调查，问程序员最头痛的事情是什么，通过Quora和Ubuntu Forum的调查结果显示，程序员最头疼的事情是命名。如果你曾经为了一个命名而绞尽脑汁，就不会对这个结果感到意外。</p>
<p>就像Stack Overflow的创始人Joel Spolsky所说的：“起一个好名字应该很难，因为，一个好名字需要把要义浓缩在一到两个词。（Creating good names is hard, but it should be hard, because a great name captures essential meaning in just one or two words）。”</p>
<p>是的，这个浓缩的过程就是抽象的过程。我不止一次的发现，当我觉得一个地方的命名有些别扭的时候，往往就意味着要么这个地方我没有思考清楚，要么是我的抽象弄错了。</p>
<p>关于如何命名，我在《代码精进之路》里已经有比较详尽的阐述，这里就不赘述了。</p>
<p>我想强调的是语言是明晰概念的基础，也是抽象思维的基础，在构建一个系统时，值得我们花很多时间去斟酌、去推敲语言。在我做过的一个项目中，就曾为一个关键实体讨论了两天，因为那是一个新概念，尝试了很多名字，始终感觉到别扭、不好理解。随着我们讨论的深入，对问题域理解的深入，我们最终找到了一个相对比较合适的名字，才肯罢休。</p>
<p>这样的斟酌是有意义的，因为明晰关键概念，是我们设计中的重要工作。虽然不合理的命名，不合理的抽象也能实现业务功能。但其代价就是维护系统时，极高的认知负荷。随着时间的推移，就没人能搞懂系统的设计了。</p>
<h1 id="1-3-抽象的层次性"><a href="#1-3-抽象的层次性" class="headerlink" title="1.3 抽象的层次性"></a>1.3 抽象的层次性</h1><p>回到毕加索的抽象画，如下图所示，如果映射到面向对象编程，抽象牛就是抽象类（Abstract Class），代表了所有牛的抽象。抽象牛可以泛化成更多的牛，比如水牛、奶牛、牦牛等。每一种牛都代表了一类（Class）牛，对于每一类牛，我们可以通过实例化，得到一头具体的牛实例（Instance）。 <img src="https://mmbiz.qpic.cn/mmbiz_png/iadkjxbLay4icWxjfM8Zo7y2icbjLiapvwzJ7GdAIzQz3Cl3BdXR5YNHicFQF5w5rLs4R67uQBQHxsDmeM3GialzN3wA/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>从这个简单的案例中，我们可以到抽象的三个特点：</p>
<ol>
<li>第一，抽象是忽略细节的。抽象类是最抽象的，忽略的细节也最多，就像抽象牛，只是几根线条而已。在代码中，这种抽象可以是Abstract Class，也可以是Interface。</li>
<li>第二，抽象代表了共同性质。类（Class）代表了一组实例（Instance）的共同性质，抽象类（Abstract Class）代表了一组类的共同性质。对于我们上面的案例来说，这些共同性质就是抽象牛的那几根线条。</li>
<li>第三，抽象具有层次性。抽象层次越高，内涵越小，外延越大，也就是说它的涵义越小，泛化能力越强。比如，牛就要比水牛更抽象，因为它可以表达所有的牛，水牛只是牛的一个种类（Class）。</li>
</ol>
<p>抽象的这种层次性，是除了抽象概念之外，另一个我们必须要深入理解的概念，因为小到一个方法要怎么写，大到 一个系统要如何架构，以及我们后面第三章要介绍的结构化思维，都离不开抽象层次的概念。</p>
<p>在进一步介绍抽象层次之前，我们先来理解一下外延和内涵的意思：</p>
<p><em>抽象是以概念（词语）来反映现实的过程，每一个概念都有一定的外延和内涵．概念的外延就是适合这个概念的一切对象的范围，而概念的内涵就是这个概念所反映的对象的本质属性的总和．例如“平行四边形”这个概念，它的外延包含着一切正方形、菱形、矩形以及一般的平行四边形，而它的内涵包含着一切平行四边形所共有的“有四条边，两组对边互相平行”这两个本质属性。</em></p>
<p><em>一个概念的内涵愈广，则其外延愈狭；反之，内涵愈狭，则其外延愈广。例如，“平行四边形”的内涵是“有四条边，两组对边互相平行”，而“菱形”的内涵除了这两条本质属性外，还包含着“四边相等”这一本质属性。“菱形”的内涵比“平行四边形”的内涵广，而“菱形”的外延要比“平行四边形”的外延狭。</em></p>
<p>所谓的抽象层次就体现在概念的外延和内涵上，这种层次性，基本可以体现在任何事物上，比如一份报纸就存在多个层次上的抽象，“出版品”最抽象，其内涵最小，但外延最大，“出版品”可以是报纸也可以是期刊杂志等。</p>
<ol>
<li>一个出版品</li>
<li>一份报纸</li>
<li>《旧金山纪事报》</li>
<li>5 月 18 日的《旧金山纪事报》</li>
</ol>
<p>当我要统计美国有多少个出版品，那么就要用到最上面第一层“出版品”的抽象，如果我要查询旧金山5月18日当天的新闻，就要用到最下面第四层的抽象。</p>
<p>每一个抽象层次都有它的用途，对于我们工程师来说，如何拿捏这个抽象层次是对我们设计能力的考验，抽象层次太高和太低都不行。</p>
<p>比如，现在要写一个水果程序，我们需要对水果进行抽象，因为水果里面有红色的苹果，我们当然可以建一个RedApple的类，但是这个抽象层次有点低，只能用来表达“红色的苹果”。来一个绿色的苹果，你还得新建一个GreenApple类。</p>
<p>为了提升抽象层次，我们可以把RedApple类改成Apple类，让颜色变成Apple的属性，这样红色和绿色的苹果就都能表达了。再继续往上抽象，我们还可以得到水果类、植物类等。再往上抽象就是生物、物质了。</p>
<p>你可以看到，抽象层次越高，内涵越小，外延越大，泛化能力越强。然而，其代价就是业务语义表达能力越弱。 <img src="https://mmbiz.qpic.cn/mmbiz_png/iadkjxbLay4icWxjfM8Zo7y2icbjLiapvwzJJEoGUJEibQvh65NYkb67cgYFLeIEg0K6IG5dv0cTxaj4B6VXzGBicstg/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>具体要抽象到哪个层次，要视具体的情况而定了，比如这个程序是专门研究苹果的可能到Apple就够了，如果是卖水果的可能需要到Fruit，如果是植物研究的可能要到Plant，但很少需要到Object。</p>
<p>我经常开玩笑说，你把所有的类都叫Object，把所有的参数都叫Map的系统最通用，因为Object和Map的内涵最小，其延展性最强，可以适配所有的扩展。从原理上来说，这种抽象也是对的，万物皆对象嘛。但是这种抽象又有什么意义呢？它没有表达出任何想表达的东西，只是一句正确的废话而已。</p>
<p>越抽象，越通用，可扩展性越强，然而其语义的表达能力越弱。越具体，越不好延展，然而其语义表达能力很强。所以，对于抽象层次的权衡，是我们系统设计的关键所在，也是区分普通程序员和优秀程序员的关键所在。</p>
<h1 id="1-4-软件中的分层抽象无处不在"><a href="#1-4-软件中的分层抽象无处不在" class="headerlink" title="1.4 软件中的分层抽象无处不在"></a>1.4 软件中的分层抽象无处不在</h1><p>越是复杂的问题越需要分层抽象，分层是分而治之，抽象是问题域的合理划分和概念语义的表达。不同层次提供不同的抽象，下层对上层隐藏实现细节，通过这种层次结构，我们才有可能应对像网络通信、云计算等超级复杂的问题。</p>
<p>网络通信是互联网最重要的基础实施，但同时它又是一个很复杂的过程，你要知道把数据包传给谁——IP协议，你要知道在这个不可靠的网络上出现状况要怎么办——TCP协议。有这么多的事情需要处理，我们可不可以在一个层次中都做掉呢？当然是可以的，但显然不科学。因此，ISO制定了网络通信的七层参考模型，每一层只处理一件事情，低层为上层提供服务，直到应用层把HTTP，FTP等方便理解和使用的协议暴露给用户。 <img src="https://mmbiz.qpic.cn/mmbiz_png/iadkjxbLay4icWxjfM8Zo7y2icbjLiapvwzJNYz9rzLDcpR0lopPmcrQoNsibOswociaRaEffdXoToaiad7AITZHaL9JA/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>编程语言的发展史也是一个典型的分层抽象的演化史。</p>
<p>机器能理解的只有机器语言，即各种二进制的01指令。如果我们采用O1的输入方式，其编程效率极低（学过数字电路的同学，体会下用开关实现加减法）。所以我们用汇编语言抽象了二进制指令。然而汇编还是很底层，于是我们用C语言抽象了汇编语言。而高级语言Java是类似于C这样低级语言的进一步抽象，这种逐层抽象极大的提升了我们的编程效率。 <img src="https://mmbiz.qpic.cn/mmbiz_png/iadkjxbLay4icWxjfM8Zo7y2icbjLiapvwzJlTnrKwia3EyPoxgOSictBD4v6nuOIzKd6xd9pgPbjQpNvhYNzk6NNarw/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<h1 id="1-5-重复代码是抽象的缺失"><a href="#1-5-重复代码是抽象的缺失" class="headerlink" title="1.5 重复代码是抽象的缺失"></a>1.5 重复代码是抽象的缺失</h1><p>如果说抽象的本质是共性的话，那么我们代码中的重复代码，是不是就意味着抽象的缺失呢？</p>
<p>是这样的，重复代码是典型的代码坏味道，其本质问题就是抽象的缺失。因为我们Ctrl+C加Ctrl+V的工作习惯，导致没有对共性代码进行抽取，或者虽然抽取了，只是简单的用了一个Util名字，没有给到一个合适的名字，没有正确的反应这段代码所体现的抽象概念，都属于抽象不到位。</p>
<p>有一次，我在Review团队代码的时候，发现有一段组装搜索条件的代码，在几十个地方都有重复。这个搜索条件还比较复杂，是以元数据的形式存在数据库中，因此组装的过程是这样的：</p>
<ul>
<li>首先，我们要从缓存中把搜索条件列表取出来；</li>
<li>然后，遍历这些条件，将搜索的值填充进去；</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//取默认搜索条件</span><br><span class="line">List&lt;String&gt; defaultConditions = searchConditionCacheTunnel.getJsonQueryByLabelKey(labelKey);</span><br><span class="line">for(String jsonQuery : defaultConditions)&#123;</span><br><span class="line">	jsonQuery = jsonQuery.replaceAll(SearchConstants.SEARCH_DEFAULT_PUBLICSEA_ENABLE_TIME, String.valueOf(System.currentTimeMillis() / 1000));</span><br><span class="line">	jsonQueryList.add(jsonQuery);</span><br><span class="line">&#125;</span><br><span class="line">//取主搜索框的搜索条件</span><br><span class="line">if(StringUtils.isNotEmpty(cmd.getContent()))&#123;</span><br><span class="line">    List&lt;String&gt; jsonValues = searchConditionCacheTunnel.getJsonQueryByLabelKey(SearchConstants.ICBU_SALES_MAIN_SEARCH);</span><br><span class="line">    for (String value : jsonValues) &#123;</span><br><span class="line">		String content = StringUtil.transferQuotation(cmd.getContent());</span><br><span class="line">		value = StringUtil.replaceAll(value, SearchConstants.SEARCH_DEFAULT_MAIN, content);</span><br><span class="line">    	jsonQueryList.add(value);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>简单的重构无外乎就是把这段代码提取出来，放到一个Util类里面给大家复用。然而我认为这样的重构只是完成了工作的一半，我们只是做了简单的归类，并没有做抽象提炼。</p>
<p>简单分析，不难发现，此处我们是缺失了两个概念：一个是用来表达搜索条件的类——<code>SearchCondition</code>；另一个是用来组装搜索条件的类——<code>SearchConditionAssembler</code>。只有配合命名，显性化的将这两个概念表达出来，才是一个完整的重构。</p>
<p>重构后，搜索条件的组装会变成一种非常简洁的形式，几十处的复用只需要引用<code>SearchConditionAssembler</code>就好了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public class SearchConditionAssembler &#123;</span><br><span class="line">    public static SearchCondition assemble(String labelKey)&#123;</span><br><span class="line">        String jsonSearchCondition =  getJsonSearchConditionFromCache(labelKey);</span><br><span class="line">        SearchCondition sc = assembleSearchCondition(jsonSearchCondition);</span><br><span class="line">        return sc;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由此可见，提取重复代码只是我们重构工作的第一步。对重复代码进行概念抽象，寻找有意义的命名才是我们工作的重点。</p>
<p>因此，每一次遇到重复代码的时候，你都应该感到兴奋，想着，这是一次锻炼抽象能力的绝佳机会，当然，测试代码除外。</p>
<h1 id="1-6-强制类型转换是抽象层次有问题"><a href="#1-6-强制类型转换是抽象层次有问题" class="headerlink" title="1.6 强制类型转换是抽象层次有问题"></a>1.6 强制类型转换是抽象层次有问题</h1><p>面向对象设计里面有一个著名的SOLID原则是由Bob大叔（Robert Martin）提出来的，其中的L代表LSP，就是Liskov Substitution Principle（里氏替换原则）。简单来说，里氏替换原则就是子类应该可以替换任何父类能够出现的地方，并且经过替换以后，代码还能正常工作。</p>
<p>思考一下，我们在写代码的过程中，什么时候会用到强制类型转换呢？当然是LSP不能被满足的时候，也就是说子类的方法超出了父类的类型定义范围，为了能使用到子类的方法，只能使用类型强制转换将类型转成子类类型。</p>
<p>举个例子，在苹果（Apple）类上，有一个isSweet()方法是用来判断水果甜不甜的；西瓜（Watermelon）类上，有一个isJuicy()是来判断水分是否充足的；同时，它们都共同继承一个水果（Fruit）类</p>
<p>此时，我们需要挑选出甜的水果和有水分的习惯，我们会写一个如下的程序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">public class FruitPicker &#123;</span><br><span class="line"></span><br><span class="line">    public List&lt;Fruit&gt; pickGood(List&lt;Fruit&gt; fruits)&#123;</span><br><span class="line">        return fruits.stream().filter(e -&gt; check(e)).</span><br><span class="line">                collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    private boolean check(Fruit e) &#123;</span><br><span class="line">        if(e instanceof Apple)&#123;</span><br><span class="line">            if(((Apple) e).isSweet())&#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if(e instanceof Watermelon)&#123;</span><br><span class="line">            if(((Watermelon) e).isJuicy())&#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因为pick方法的入参的类型是Fruit，所以为了获得Apple和Watermelon上的特有方法，我们不得不使用instanceof做一个类型判断，然后使用强制类型转换转成子类类型，以便获得他们的专有方法，很显然，这是违背了里式替换原则的。</p>
<p>这里问题出在哪里？对于这样的代码我们要如何去优化呢？仔细分析一下，我们可以发现，根本原因是因为isSweet和isJuicy的抽象层次不够，站在更高抽象层次也就是Fruit的视角看，我们挑选的就是可口的水果，只是具体到苹果我们看甜度，具体到西瓜我们看水分而已。</p>
<p>因此，解决方法就是对isSweet和isJuicy进行抽象，并提升一个层次，在Fruit上创建一个isTasty()的抽象方法，然后让苹果和西瓜类分别去实现这个抽象方法就好了。 </p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/iadkjxbLay4icWxjfM8Zo7y2icbjLiapvwzJ2NSOtFF5ZIWOoqvDEAPDCjiaTfTLWY4tg6XibQjkymkW0zxTUxoia5QAQ/640?wx_fmt=png&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>下面是重构后的代码，通过抽象层次的提升我们消除了instanceof判断和强制类型转换，让代码重新满足了里式替换原则。抽象层次的提升使得代码重新变得优雅了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class FruitPicker &#123;</span><br><span class="line"></span><br><span class="line">    public List&lt;Fruit&gt; pickGood(List&lt;Fruit&gt; fruits)&#123;</span><br><span class="line">        return fruits.stream().filter(e -&gt; check(e)).</span><br><span class="line">                collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    //不再需要instanceof和强制类型转换</span><br><span class="line">    private boolean check(Fruit e) &#123;</span><br><span class="line">        return e.isTasty();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所以，每当我们在程序中准备使用instanceof做类型判断，或者用cast做强制类型转换的时候。每当我们的程序不满足LSP的时候。你都应该警醒一下，好家伙，这又是一次锻炼抽象能力的绝佳机会。</p>
<h1 id="1-7-如何提升抽象思维能力"><a href="#1-7-如何提升抽象思维能力" class="headerlink" title="1.7 如何提升抽象思维能力"></a>1.7 如何提升抽象思维能力</h1><p>抽象思维能力是我们人类特有的、与生俱来的能力，除了上面说的在编码过程中可以锻炼抽象能力之外，我们还可以通过一些其他的练习，不断的提升我们的抽象能力。</p>
<h2 id="多阅读"><a href="#多阅读" class="headerlink" title="多阅读"></a>多阅读</h2><p>为什么阅读书籍比看电视更好呢？因为图像比文字更加具象，阅读的过程可以锻炼我们的抽象能力、想象能力，而看画面的时候会将你的大脑铺满，较少需要抽象和想象。</p>
<p>这也是为什么我们不提倡让小孩子过多的暴露在电视或手机屏幕前的原因，因为这样不利于他抽象思维的锻炼。</p>
<p>抽象思维的差别让孩子们的学习成绩从初中开始分化，许多不能适应这种抽象层面训练的，就去读技校了，因为技校比大学会更加具象：车铣刨磨、零部件都能看得见摸得着。体力劳动要比脑力劳动来的简单。</p>
<h2 id="多总结沉淀"><a href="#多总结沉淀" class="headerlink" title="多总结沉淀"></a>多总结沉淀</h2><p>小时候不理解，语文老师为什么总是要求我们总结段落大意、中心思想什么的。现在回想起来，这种思维训练在基础教育中是非常必要的，其实质就是帮助学生提升抽象思维能力。</p>
<p>记录也是很好的总结习惯。就拿读书笔记来说，最好不要原文摘录书中的内容，而是要用自己的话总结归纳书中的内容，这样不仅可以加深理解，而且还可以提升自己的抽象思维能力。</p>
<p>我从四年前开始系统的记录笔记，做总结沉淀，构建自己的知识体系。这种思维训练的好处显而易见，可以说我之前写的《从码农到工匠》和现在正在写的《程序员必备的思维能力》都离不开我总结沉淀的习惯。</p>
<h2 id="命名训练"><a href="#命名训练" class="headerlink" title="命名训练"></a>命名训练</h2><p>每一次的变量命名、方法命名、类命名都是一次难得的抽象思维训练机会，前面已经说过了，语言和抽象是一体的，命名的好坏直接反应了我们的问题域思考的是否清晰，反应了我们抽象的是否合理。</p>
<p>现实情况是，我们很多的工程师常常忽略了命名的重要性，只要能实现业务功能，名字从来就不是重点。</p>
<p>实际上，这是对系统的不负责任，也是对自己的不负责任，更是对后期维护系统的人不负责任。写程序和写文章有很大的相似性，本质上都是在用语言阐述一件事情。试想下，如果文章中用的都是些词不达意的句子，这样的文章谁能看得懂，谁又愿意去看呢。</p>
<p>同样，我一直强调代码要显性化的表达业务语义，其中命名在这个过程中扮演了极其重要的角色。为了代码的可读性，为了系统的长期可维护性，为了我们自身抽象思维的训练，我们都不应该放过任何一个带有歧义、表达模糊、意不清的命名。</p>
<h2 id="领域建模训练"><a href="#领域建模训练" class="headerlink" title="领域建模训练"></a>领域建模训练</h2><p>对于技术同学，我们还有一个非常好的提升抽象能力的手段——领域建模。当我们对问题域进行分析、整理和抽象的时候，当我们对领域进行划分和建模的时候，实际上也是在锻炼我们的抽象能力。</p>
<p>我们可以对自己工作中的问题域进行建模，当然也可以通过阅读一些优秀源码背后的模型设计来学习如何抽象、如何建模。比如，我们知道Spring的核心功能是Bean容器，那么在看Spring源码的时候，我们可以着重去看它是如何进行Bean管理的？它使用的核心抽象是什么？不难发现，Spring是使用了BeanDefinition、BeanFactory、BeanDefinitionRegistry、BeanDefinitionReader等核心抽象实现了Bean的定义、获取和创建。抓住了这些核心抽象，我们就抓住了Spring设计主脉。</p>
<p>除此之外，我们还可以进一步深入思考，它为什么要这么抽象？这样抽象的好处是什么？以及它是如何支持XML和Annotation（注解）这两种关于Bean的定义的。</p>
<p>这样的抽象思维锻炼和思考，对提升我们的抽象能力和建模能力非常重要。关于这一点，我深有感触，初入职场的时候，当我尝试对问题域进行抽象和建模的时候，会觉得无从下手，建出来的模型也感觉很别扭。然而，经过长期的、刻意的学习和锻炼之后，很明显可以感觉到我的建模能力和抽象能力都有很大的提升。不但分析问题的速度更快了，而且建出来的模型也更加优雅了。</p>
<h1 id="1-8-小结"><a href="#1-8-小结" class="headerlink" title="1.8 小结"></a>1.8 小结</h1><ul>
<li>抽象思维是程序员最重要的思维能力，抽象的过程就是寻找共性、归纳总结、综合分析，提炼出相关概念的过程。</li>
<li>语言和抽象是一体的，抽象思维也叫词思维，因为抽象的概念只能通过语言才能表达出来。</li>
<li>抽象是有层次性的，抽象层次越高，内涵越小，外延越大，扩展性越好；反之，抽象层次越低，内涵越大，外延越小，扩展性越差，但语义表达能力越强。</li>
<li>对抽象层次的拿捏，体现了我们的设计功力，视具体情况而定，抽象层次既不能太高，也不能太低。</li>
<li>重复代码意味着抽象缺失，强制类型转换意味着抽象层次有问题，我们可以利用这些信号来重构代码，让代码重新变的优雅。</li>
<li>我们可以通过刻意练习来提升抽象能力，这些练习包括阅读、总结、命名训练、建模训练等。</li>
</ul>
<p>参考文档</p>
<blockquote>
<p>[1] <a href="https://baike.baidu.com/item/抽象/9021828" target="_blank" rel="noopener">https://baike.baidu.com/item/抽象/9021828</a></p>
</blockquote>
<blockquote>
<p>[2] <a href="https://zh.wikipedia.org/wiki/抽象化" target="_blank" rel="noopener">https://zh.wikipedia.org/wiki/抽象化</a></p>
</blockquote>
<blockquote>
<p>[3] <a href="https://baike.baidu.com/item/抽象思维" target="_blank" rel="noopener">https://baike.baidu.com/item/抽象思维</a></p>
</blockquote>
<blockquote>
<p>[4] <a href="https://www.sohu.com/a/359915387_260616" target="_blank" rel="noopener">https://www.sohu.com/a/359915387_260616</a></p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.shengfq.github.io/2021/07/05/XX公司生产事故复盘分析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="盛富强">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程序员shengfq">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/07/05/XX公司生产事故复盘分析/" itemprop="url">XX公司生产事故-高并发下访问redis一个key</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-07-05T00:00:00+08:00">
                2021-07-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>故障分析:<br>在分布式服务部署环境,高并发访问时,一个seq生成到临界点了,单秒订单记录重复,然后引发了一系列的问题</p>
<p>问题代码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public string getSeq()&#123;</span><br><span class="line">    long seq=redisClient.incr(SN_REDIS_KEY);</span><br><span class="line">    if(seq&gt;999999)&#123;</span><br><span class="line">      seq=1;</span><br><span class="line">      redisClient.del(SN_REDIS_KEY);</span><br><span class="line">      seq=redisClient.incr(SN_REDIS_KEY);</span><br><span class="line">    &#125;</span><br><span class="line">    return string.format(&quot;%06d&quot;,seq);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>原因:<br>这段代码是redis客户端执行del操作,下一步是incr操作,如果是在高并发场景下,没有加锁控制,会导致服务副本不安全执行上面的代码导致redis客户端返回的数据是脏数据,从而程序的执行逻辑出现异常.</p>
<p>解决:<br>这段代码如果是单体服务,要做进程内的加锁操作,可以使用sync(低效率简单),也可以使用可重入锁.<br>如果是在分布式多副本环境下,要做分布式锁操作,方案有三个:<br>使用zk实现分布式锁,在锁环境下操作上述代码.<br>使用redis实现全局原子性操作,redis可以分发分布式锁,redis可以执行lua脚本,保障全局下,这段代码操作的原子性.</p>
<p>秦老师的解决方案:<br>ringbuffer,imax方案,单机tps达到600万.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.shengfq.github.io/2021/03/18/程序员-如何提升实力/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="盛富强">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程序员shengfq">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/03/18/程序员-如何提升实力/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-03-18T22:32:02+08:00">
                2021-03-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>title: 程序员-如何提升实力<br>date: 2021-03-19<br>tags: mind</p>
<p>作者：kimmking<br>链接：<a href="https://www.zhihu.com/question/315201616/answer/1756148937" target="_blank" rel="noopener">https://www.zhihu.com/question/315201616/answer/1756148937</a><br>来源：知乎<br>以下几个任何一个都可以超过90%程序员：<br>1.把事情想明白，说清楚，跟别人商量好<br>2.写代码，注意边界条件和编码规范，写单测，基本做到无bug提测<br>3.工作中做好计划和进度跟踪，沟通和汇报，不把问题遗留到变成事故<br>4.思考和分析，如何优化目前的工作流程，引入工具和方法，提升生产效率<br>5.把自己工作中用到的技术用熟，搞清楚原理，优点短处，适用场景<br>6.不断接触新技术思想和工具，完善自身知识体系结构<br>7.深入学习至少一个常用开源项目，源码层面系统掌握这项技术<br>8.持续坚持学习和技术内容输出，每个星期产出2篇原创技术文章</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.shengfq.github.io/2020/11/12/编程思想-解耦实践/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="盛富强">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程序员shengfq">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/11/12/编程思想-解耦实践/" itemprop="url">编程思想-解耦实践</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-11-12T00:00:00+08:00">
                2020-11-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>场景分类介绍</p>
<p>[TOC]</p>
<h1 id="场景分类"><a href="#场景分类" class="headerlink" title="场景分类"></a>场景分类</h1><h2 id="责任链模式解耦"><a href="#责任链模式解耦" class="headerlink" title="责任链模式解耦"></a>责任链模式解耦</h2><p>案例:当出现要用excel的规则逻辑来设计对同一个数据输入源进行处理时,发现规则而逻辑可以和线程控制分离,而这个分离器就是责任链模式,参考了汽车车轮和发动机直接用离合器的思想,再往下延伸离合器可以是手动挡,也可以是自动挡,自动挡离合器的原理是什么呢?</p>
<h2 id="文件操作解耦"><a href="#文件操作解耦" class="headerlink" title="文件操作解耦"></a>文件操作解耦</h2><p>案例 cms的发布流程:模板文件和数据集成生成静态文件推送到ftp后,如何清理本地的副本文件.</p>
<p>初级方案:将删除文件流程加入到程序流程中,实现创建-传输-删除一体的事务管理,缺点,文件量大,过程较长导致线程占用资源较长,不利于高性能扩展,如果程序没有清理该文件将被忽略.</p>
<p>解耦方案:是将删除文件的操作交给定时任务执行shell,清除某个文件目录下的文件,直接批量删除,这样创建文件与删除文件就不用直接耦合到一起,清理文件批量高效,也不用占用IO资源.不会存在文件遗漏,而且在大批量文件操作性能更好.</p>
<h2 id="mq实现解耦"><a href="#mq实现解耦" class="headerlink" title="mq实现解耦"></a>mq实现解耦</h2><p>案例:cms的失效页批量替换,也是涉及到批量文件的发布.</p>
<p>初级方案:如果全部在主线程中处理,将导致线程阻塞,主线程池无法及时释放会导致线程池爆仓,影响用户体验.</p>
<p>解耦方案:所以我采用了mq消息解耦,将批量文件替换的需求以消息形式发送,页面端请求线程快速返回.,用状态机来反馈处理结果.这样在处理大量的文件发布时,有消息队列堆积来完成消费,生产者只需要推消息.这种情况在电商系统中常用于秒杀,下单等高并发场景.</p>
<h2 id="规则引擎-让控制和具体的业务逻辑解耦"><a href="#规则引擎-让控制和具体的业务逻辑解耦" class="headerlink" title="规则引擎,让控制和具体的业务逻辑解耦"></a>规则引擎,让控制和具体的业务逻辑解耦</h2><p>没有具体案例,规则引擎也是一把双刃剑,适应场景有.</p>
<p>1、只有少量静态规则，并且不经常改变，不建议使用规则引擎；</p>
<p>2、需要在运行时动态修改规则，可考虑使用规则引擎；</p>
<p>3、在应用程序中需要通过可视化工具来修改规则，可考虑使用规则引擎；</p>
<p>4、规则需要非技术人员维护的情况下，可考虑使用规则引擎；</p>
<p>5、如果项目工期较紧，除非非常熟悉规则引擎，否则不建议使用；</p>
<p>6、如果使用Excel来管理规则，可考虑使用规则引擎；</p>
<h2 id="xxl-job定时任务解耦"><a href="#xxl-job定时任务解耦" class="headerlink" title="xxl-job定时任务解耦"></a>xxl-job定时任务解耦</h2><p>案例:将定时任务放入第三方中间件xxl-job中</p>
<p>初级方案:在服务中开启schedule,定时执行,这样的优点是当定时任务数量较少,单服有优势.对于分布式微服务集群场景就会有重复执行的bug.</p>
<p>解耦方案:避免了分布式集群下,任务重复执行的场景,job的生产端和执行端解耦,并发执行能力强.</p>
<p>常用的任务(定时发布主页/定时发布模块/定时创建新闻ES索引和文档入库)</p>
<h2 id="数据同步操作解耦"><a href="#数据同步操作解耦" class="headerlink" title="数据同步操作解耦"></a>数据同步操作解耦</h2><p>案例:cms是有新老系统迁移的场景,在新闻业务上,有数据同步到老系统的业务,</p>
<p>初级方案:第一版本实现是将数据回写老系统直接耦合到业务逻辑,增加了业务复杂性.同步数据与业务逻辑耦合增加业务逻辑复杂性,而且不同的数据库操作保持一致性使用分布式事务非常麻烦.</p>
<p>解耦方案:数据同步这种跟业务逻辑关联并不大,只是数据同步要看需求:实时性/一致性/并发性/</p>
<p>同步操作会逐步退出业务逻辑,实时性要求并不高,只需要最终一致就行.就推荐使用streamset的dcd同步功能,使用易购系统,基于mysql的binlog日志实现数据的同步变更.</p>
<p>其他解耦方案:</p>
<p>在离线数据非实时同步场景,基于datax的离线数据同步</p>
<p>在业务复杂非实时场景:基于dts的实时在线数据同步</p>
<h2 id="状态机解耦"><a href="#状态机解耦" class="headerlink" title="状态机解耦"></a>状态机解耦</h2><p>案例:二手房贷款诈骗模型</p>
<p>需求背景:一批数据经过 税务局,房管局,银保监,公安局各个节点的逻辑过滤,打分(自有逻辑/外部服务数据同步打分),将高分者建立线索,通过对线索人员的社会轨迹和关系进行串并成嫌疑团伙,最后获得高分团伙.</p>
<p>初级方案:</p>
<p>按需求过程式编程,所有业务逻辑耦合,会导致业务逻辑复杂庞大,对局部的修改影响到全局,一旦某个节点无法提供数据整个程序无法执行.</p>
<p>解耦方案:</p>
<p>抽象实体:税务局处理,房管局处理,银保监处理,公安局处理.(工厂模式)</p>
<p>通用逻辑处理:获取数据列表-&gt;对数据进行评分-&gt;写入评分表.(模板模式)</p>
<p>控制器:获取待处理状态的数据批次-&gt;在工厂中获取列表-&gt;处理-&gt;更新数据批次状态,管理批次的节点任务执行状态.</p>
<p>这样一来,各个节点互相并不直接依赖,对单个的修改不会影响到其他工厂的变化(单一职责,开闭原则).</p>
<p>增加了控制器这个表和节点状态管理,将各个节点状态存储,执行任务要对状态进行判断.这样就实现了业务逻辑与控制的分离,如果要修改控制,不会对节点内的业务逻辑有影响,例如要变更控制逻辑,不需要动原有的业务代码,只需要在抽象父类工厂对控制方法变更.(模板方法的优势)</p>
<p>总结</p>
<p>通过上述解耦思想的案例场景可以得到,解耦的目的是为了可扩展性,对代码复杂度要求其实更高了,这是模块封装的一种思想.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">盛富强</p>
              <p class="site-description motion-element" itemprop="description">blogs and research</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">28</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">17</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://www.github.com/shengfq" target="_blank" title="github">
                      
                        <i class="fa fa-fw fa-globe"></i>github</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">盛富强</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
